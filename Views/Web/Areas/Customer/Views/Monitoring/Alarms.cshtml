@using KarmicEnergy.Web.Areas.Customer.ViewModels.Monitoring
@using Munizoft.Extensions
@using Munizoft.MVC.Helpers
@using KarmicEnergy.Web.Extensions
@using GridMvc.Html

@model List<AlarmViewModel>

@{
    Layout = "~/Views/Shared/_Internal.cshtml";
    ViewBag.Title = "Alarm";
}

@Styles.Render("~/Content/gridmvccss")

@Html.Grid(Model).Columns(columns =>
{
    if (!this.IsSite())
    {
        columns.Add(c => c.SiteName).Titled("Site")
            .Filterable(true);
    }

    columns.Add(c => c.TankName).Titled("Tank")
        .Sortable(true)
        .Filterable(true);

    columns.Add(c => c.SensorName).Titled("Sensor")
        .Sortable(true)
        .Filterable(true);

    columns.Add(c => c.ItemName).Titled("Item")
        .Sortable(true)
        .Filterable(true);

    columns.Add(c => c.SeverityName).Titled("Severity")
        .Sortable(true)
        .Filterable(true);

    columns.Add(c => c.AlarmDateLocal).Titled("Date")
        .Sortable(true)
        .Filterable(true);

    columns.Add(c => c.AckUser).Titled("User")
        .Sortable(true)
        .Filterable(true);

    columns.Add()
        .Encoded(false)
        .Sanitized(false)
        .SetWidth(30)
        .RenderValueAs(o => @Html.NoEncodeActionLink("<span class='glyphicon glyphicon-signal'></span>", "Ack", "Acknowledge", "Monitoring", routeValues: new { id = o.Id, area = "Customer" }, htmlAttributes: new { data_modal = "", @class = "btn btn-default" }));

    columns.Add()
       .Encoded(false)
       .Sanitized(false)
       .SetWidth(30)
       .RenderValueAs(o => @Html.NoEncodeActionLink("<span class='glyphicon glyphicon-signal'></span>", "Clear", "ClearAlarm", "Monitoring", routeValues: new { id = o.Id, area = "Customer" }, htmlAttributes: new { data_modal = "", @class = "btn btn-default" }));

}).WithPaging(10).Sortable(true).Filterable().WithMultipleFilters()

@section Scripts {
    @Scripts.Render("~/bundles/gridmvc")
    @Scripts.Render("~/bundles/bootstrap-datepicker")

    <script type="text/javascript">
        $(function () {
            showLoading();

            $('#ddlSite').on('change', function (event) {
                var form = $(event.target).parents('form');
                form.submit();
            });

            hideLoading();
        });
    </script>
}